---
title: "R Notebook"
output: html_notebook
---

## Descripci√≥n del dominio

El rendimiento acad√©mico es un tema clave en la educaci√≥n, ya que influye directamente en las oportunidades que tendr√°n los jovenes en el d√≠a de ma√±ana y en el desarrollo de nuestra sociedad. Comprender qu√© factores afectan al desempe√±o de los estudiantes permitir√° a las instituciones educativas a mejorar los m√©todos de ense√±anza, dise√±ar pol√≠ticas educativas m√°s efectivas y proporcionar un mayor apoyo a aquellos estudiantes que lo necesiten.

### Enfoque del Trabajo

Este estudio analiza los factores que influyen en el rendimiento acad√©mico de los estudiantes. Para ello, se hace uso de datos relacionados con aspectos personales, sociales y acad√©micos para identificar patrones y determinar qu√© variables tienen mayor impacto en el desempe√±o escolar.

En particular, el estudio se enfoca en responder dos preguntas fundamentales:

1.  **¬øSe pueden agrupar a los estudiantes en una clase seg√∫n sus caracter√≠sticas?**\
    La organizaci√≥n de los estudiantes dentro del aula puede influir significativamente en su aprendizaje y rendimiento. Por esta raz√≥n, se explorar√° la posibilidad de segmentar a los alumnos con base en caracter√≠sticas clave como sus calificaciones previas, el tiempo dedicado al estudio, su nivel de motivaci√≥n, la presencia de discapacidades de aprendizaje y su participaci√≥n en actividades extracurriculares.

    Este enfoque permitir√° una distribuci√≥n estrat√©gica que potencie el aprendizaje al ubicar a los estudiantes en entornos que favorezcan su desarrollo acad√©mico y personal.

2.  **¬øCu√°ntas horas de trabajo personal necesita un estudiante para obtener una alta calificaci√≥n?**\
    Otro objetivo del estudio es determinar cu√°ntas horas diarias de estudio aut√≥nomo son necesarias para que un estudiante alcance una calificaci√≥n alta (entre 8 y 10). Para ello, se identificar√°n aquellos factores que tengan mayor influencia con la calificaci√≥n del estudiante, ya que estos aspectos pueden influir en el rendimiento acad√©mico. A trav√©s de un modelo de regresi√≥n, se buscar√° cuantificar la relaci√≥n entre estas variables y el desempe√±o estudiantil, proporcionando una gu√≠a para optimizar los h√°bitos de estudio.

A trav√©s de este an√°lisis, se pretende aportar informaci√≥n valiosa para mejorar las estrategias educativas, optimizar la distribuci√≥n de los estudiantes en el aula y ofrecer recomendaciones que permitan a los alumnos maximizar su rendimiento acad√©mico.

### Inter√©s y motivaci√≥n del estudio

El mundo en el que vivimos est√° en constante transformaci√≥n. Los sistemas educativos, como muchos otros aspectos de nuestra sociedad, deben adaptarse a nuevas realidades y desaf√≠os. En este contexto, resulta crucial comprender los factores que influyen en el rendimiento acad√©mico de los estudiantes, con el objetivo de mejorar los procesos de ense√±anza y crear un entorno de aprendizaje m√°s inclusivo y eficaz. Lo interesante de este estudio radica en identificar patrones y relaciones entre distintas variables que podr√≠an tener un impacto directo en la forma en que los estudiantes aprenden y se desarrollan.

En particular, nos gustar√≠a subrayar que el rendimiento acad√©mico no depende √∫nicamente de la capacidad intelectual del estudiante, sino tambi√©n de factores como el apoyo familiar, los h√°bitos de estudio, la motivaci√≥n personal y la presencia de discapacidades de aprendizaje. Este enfoque permite adoptar una perspectiva m√°s personalizada de la educaci√≥n, lo que a su vez puede contribuir a una mejor planificaci√≥n y dise√±o de estrategias pedag√≥gicas m√°s adaptadas a las necesidades de los estudiantes.

En el grupo de desarrollo de este trabajo, nos encontramos tanto estudiantes de **Ingenier√≠a Inform√°tica** como de **Ingenier√≠a de la Salud**. Esta diversidad de perspectivas y formaciones acad√©micas enriquece el enfoque del estudio, ya que, desde distintas disciplinas, reconocemos la importancia de crear un entorno educativo que no solo se base en el rendimiento acad√©mico, sino tambi√©n en el bienestar y las capacidades individuales de cada estudiante. Al ser nosotros mismos estudiantes, sabemos de primera mano que las aulas son cada vez m√°s diversas, y entender c√≥mo organizar y distribuir a los estudiantes de acuerdo con sus necesidades espec√≠ficas es clave para optimizar su rendimiento.

### **Importancia local/nacional y en el contexto actual**

A nivel global, la educaci√≥n es un pilar fundamental para el desarrollo. Pa√≠ses con bajos √≠ndices de rendimiento acad√©mico suelen enfrentar mayores desaf√≠os econ√≥micos y sociales. Adem√°s, en un contexto postpandemia, donde la ense√±anza a distancia ha cambiado la forma en que los estudiantes aprenden, es m√°s importante que nunca entender qu√© factores afectan su desempe√±o y c√≥mo pueden optimizarse los procesos de ense√±anza.

## Descripci√≥n del dataset

El dataset ha sido extra√≠do de la plataforma Kaggle y proporcionado por el usuario *lainguyn123*. Se puede acceder al conjunto de datos a trav√©s del siguiente enlace: [Student Performance Factors Dataset](https://www.kaggle.com/datasets/lainguyn123/student-performance-factors/data).

El archivo que contiene el conjunto de datos se denomina *StudentPerformanceFactors* y est√° en formato **CSV**, con un tama√±o aproximado de **641 kB**.

Este conjunto de datos proviene de una investigaci√≥n que analiza los factores que afectan el rendimiento acad√©mico de los estudiantes. Incluye diversas variables relacionadas con caracter√≠sticas personales, acad√©micas y sociales, tales como h√°bitos de estudio, asistencia, participaci√≥n de los padres, y otros aspectos clave que influyen en el √©xito acad√©mico de los estudiantes.

En cuanto a sus dimensiones, el dataset consta de un total de:

-   **6,607 Filas**

-   **20 Columnas**

## Librer√≠as

La funci√≥n ipak est√° dise√±ada para facilitar la instalaci√≥n y carga de paquetes en R. Es √∫til cuando desea asegurarse de que todos los paquetes necesarios para un script o proyecto se instalan y cargan autom√°ticamente. <https://gist.github.com/stevenworthington/3178163>

```{r}
ipak <- function(pkg){
  new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
  if(length(new.pkg))
    install.packages(new.pkg, dependencies = TRUE)
  sapply(pkg, require, character.only = TRUE)
}

packages <- c("tidyverse","ggplot2", "dplyr","gridExtra", "reshape2", "car", "ggridges", "factoextra", "cluster")
ipak(packages)
```

## Exploraci√≥n de datos

### Lectura de los datos

```{r}
data <- read.csv("data/StudentPerformanceFactors.csv", header=TRUE)
```

### Visualizar las 6 primeras instancias del data frame

```{r}
head(data)
```

### Estructura resumida del data frame

```{r}
str(data)
```

El dataset est√° compuesto por 6,607 filas y 20 columnas, las cuales incluyen atributos de distintos tipos: num√©ricos, categ√≥ricos y booleanos.

A continuaci√≥n, se describen algunos de estos atributos:

-   **Hours_Studied**: N√∫mero de horas de estudio semanales.

-   **Attendance**: Porcentaje de clases a las que ha asistido.

-   **Parental_Involvement**: Nivel de implicaci√≥n de los padres en la educaci√≥n del alumno *(Low, Medium, High)*.

-   **Access_to_Resources**: Disponibilidad de recursos educativos *(Low, Medium, High)*.

-   **Extracurricular_Activities**: Participaci√≥n en actividades extraescolares *(Yes, No)*.

-   **Sleep_Hours**: N√∫mero medio de horas de sue√±o por noche.

-   **Previous_Scores**: Puntuaciones de ex√°menes anteriores.

-   **Motivation_Level**: Nivel de motivaci√≥n del estudiante *(Low, Medium, High)*.

-   **Internet_Access**: Disponibilidad de acceso a Internet *(Yes, No)*.

-   **Tutoring_Sessions**: N√∫mero de sesiones de tutor√≠a a las que asiste al mes.

-   **Family_Income**: Nivel de ingresos familiares *(Low, Medium, High)*.

-   **Teacher_Quality**: Calidad de los profesores *(Low, Medium, High)*.

-   **School_Type**: Tipo de escuela a la que asisti√≥ *(Public, Private)*.

-   **Peer_Influence**: Influencia de los compa√±eros en el rendimiento acad√©mico *(Positive, Neutral, Negative)*.

-   **Physical_Activity**: N√∫mero medio de horas de actividad f√≠sica a la semana.

-   **Learning_Disabilities**: Presencia de dificultades de aprendizaje *(Yes, No)*.

-   **Parental_Education_Level**: Nivel educativo m√°s alto de los padres *(High School, College, Postgraduate)*.

-   **Distance_from_Home**: Distancia de casa a la escuela *(Near, Moderate, Far)*.

-   **Gender**: G√©nero del estudiante *(Male, Female)*.

-   **Exam_Score**: Calificaci√≥n del examen final.

## Preprocesamiento de los datos

Esta funci√≥n muestra las filas con valores NA o valores vacios("").

```{r}
detect_missing_data <- function(df) {
  na_count <- colSums(is.na(df))  # Contar los NA en cada columna
  empty_count <- colSums(sapply(df, function(x) x == ""))  # Contar los valores vac√≠os en cada columna
  
  missing_data <- data.frame(NA_Count = na_count, Empty_Count = empty_count)
  missing_data <- missing_data[missing_data$NA_Count > 0 | missing_data$Empty_Count > 0, ]
  
  return(missing_data)
}


missing_data <- detect_missing_data(data)
missing_data
```

En el resultado arrojado por la funci√≥n podemos observar que no existen valores **NA** en las columnas de nuestro dataframe, lo que significa que no hay datos expl√≠citamente faltantes o nulos. Sin embargo, tambi√©n notamos que hay filas con **valores vac√≠os** en ciertas variables categ√≥ricas.

Al sumar el total de valores faltantes podemos observar que puede haber un m√°ximo de **235 filas** con alg√∫n valor faltante. Esto supone aproximadamente el **3.56%** del total de filas del conjunto de datos.

Dado que la proporci√≥n de filas con valores faltantes es relativamente baja, consideramos eliminar estas instancias ya que creemos que no tendr√° un impacto significativo en la integridad general del dataset.

```{r}
clean_missing_data <- function(df) {
  original_row_count <- nrow(df)
  
  df <- df[!apply(df, 1, function(x) any(is.na(x) | x == "")), ] #Borramos las filas
  
  cleaned_row_count <- nrow(df)
  rows_removed <- original_row_count - cleaned_row_count
  cat("N√∫mero de filas eliminadas:", rows_removed, "\n")
  
  return(df)
}

data <- clean_missing_data(data)
```

Observamos que se han eliminado 229 filas por lo que el dataset sin ning√∫n valor de faltante constar√≠a de un total de **6378 filas**.

### Detecci√≥n de outliers

```{r}
numeric_cols <- sapply(data, is.numeric)

count_outliers <- function(x) {
  Q1 <- quantile(x, 0.25, na.rm = TRUE)
  Q3 <- quantile(x, 0.75, na.rm = TRUE)
  IQR <- Q3 - Q1
  lower_bound <- Q1 - 1.5 * IQR
  upper_bound <- Q3 + 1.5 * IQR
  sum(x < lower_bound | x > upper_bound, na.rm = TRUE)
}


for (col_name in names(data)[numeric_cols]) {
  num_outliers <- count_outliers(data[[col_name]])
  print(paste("Variable:", col_name, "- Outliers:", num_outliers))
}
```

Podemos observar que existen outliers en las variables `Hours_studies`, `Tutoring_Sessions` y `Exam_Score`. Vamos a visualizar dichos valores mediante gr√°ficos de caja para observar la distribuci√≥n de ciertos valores.

```{r}
plot_boxplots <- function(df) {
  plots <- list()
  numeric_cols <- c("Hours_Studied", "Tutoring_Sessions", "Exam_Score")
  numeric_cols <- numeric_cols[numeric_cols %in% names(df)]
  

  for (var in numeric_cols) {
    p <- ggplot(df, aes_string(y = var)) +
      geom_boxplot(fill = "orange", alpha = 0.7) +
      theme_minimal() +
      labs(title = paste("Outliers in", var), y = var)
    
    plots[[var]] <- p
  }

  for (p in plots) {
    print(p)
  }
}
```

```{r}
plot_boxplots(data)
```

Al observar los gr√°ficos de caja, podemos identificar la presencia de valores at√≠picos. Sin embargo, algunos de estos valores no deben considerarse como tales. Por ejemplo, 8 horas de tutor√≠as es un valor completamente v√°lido. En cambio, en el gr√°fico de `Exam_Scores`, se pueden notar calificaciones que superan el valor m√°ximo permitido de 100, lo que indica un posible error en los datos.

Para solucionar esto, filtraremos las filas en las que el valor de `Exam_Score` sea superior a 100 y lo estableceremos a la m√°xima nota posible, es decir, 100.

```{r}
data$Exam_Score[data$Exam_Score > 100] <- 100
max_Exam_score <- max(data$Exam_Score)
print(max_Exam_score)
```

### Codificaci√≥n

Para preparar los datos de manera √≥ptima para el an√°lisis, aplicamos varias transformaciones a las variables categ√≥ricas y ordinales. Esto nos permite estructurar la informaci√≥n de manera que los modelos puedan interpretarla correctamente.

Con esta funci√≥n convertimos las columnas del data frame en factores ordenados y les asignamos valores enteros, de acuerdo con un orden espec√≠fico de niveles. Esto es util para las variables que tienen una relaci√≥n de orden o tienen un nivel jer√°rquico o progresivo, es decir, que pueden compararse en t√©rminos de m√°s o menos, mejor o peor, mayor o menor.

-   `Parental_Involvement`,`Access_to_Resources`,`Motivation_Level`,`Family_Income`,`Teacher_Quality` Estas variables pueden ordenarse de menor a mayor o viceversa".

-   En `Peer_Influence`, **Positive \> Neutral \> Negative** en t√©rminos de impacto en el rendimiento. Por lo que tambien se pueden ordenar.

-   En `Distance_from_Home` ordenamos los valores en t√©rminos de **nivel de cercan√≠a** de la escuela a la casa del estudiante.

-   En `Parental_Education_Level` ordenamos los valores en t√©rminos de **nivel de estudio de los padres**. Desde menos estudios (High School) hasta m√°s estudios (Postgraduate).

```{r}
convert_to_ordered_int <- function(df, column_names, levels_order, ordered = TRUE) {
  for (col in column_names) {
    if (col %in% colnames(df)) {
      df[[col]] <- as.integer(factor(df[[col]], levels = levels_order, ordered = ordered))
    }
  }
  return(df)
}

```

Algunas variables categ√≥ricas contienen √∫nicamente valores "Yes" o "No", por lo que es m√°s eficiente transformarlas en valores 0 y 1, 'No' y 'Yes', respectivamente.

Las variables modificadas ser√°n:

-   `Extracurricular_Activities`, `Internet_Access`, `Learning_Disabilities` ‚Üí Yes = 1, No = 0

```{r}
convert_to_binary <- function(df, column_names) {
  for (col in column_names) {
    if (col %in% colnames(df)) {
      df[[col]] <- ifelse(df[[col]] == "Yes", 1, 0)
    }
  }
  return(df)
}

```

Algunas variables no tienen una jerarqu√≠a clara, por lo que en lugar de asignar valores ordinales, creamos columnas binarias (dummies) para cada categor√≠a, es decir, aplicamos One-Hot Encoding.

-   `School_Type` pasar√° a dividirse en dos columnas: `School_Type_Public` y `School_Type_Private`
-   `Gender` se convierte en `Gender_Male` y `Gender_Female`.

```{r}
convert_to_one_hot <- function(df, column_names) {
  for (col in column_names) {
    if (col %in% colnames(df)) {
      unique_values <- unique(df[[col]])
      for (val in unique_values) {
        new_col_name <- paste(col, val, sep = "_")
        df[[new_col_name]] <- ifelse(df[[col]] == val, 1, 0)
      }
      df[[col]] <- NULL  # Eliminamos la columna original despu√©s de crear las dummy variables
    }
  }
  return(df)
}

```

```{r}
clean_and_filter_data <- function(data) {
  data <- data %>%
    distinct() %>%
    
    # Convertir a valores ordenados (Low < Medium < High)
    convert_to_ordered_int(c("Parental_Involvement", "Access_to_Resources", "Motivation_Level",
                              "Family_Income", "Teacher_Quality"),
                           c("Low", "Medium", "High")) %>%
    
    # Convertir Peer_Influence en valores ordenados (Negative < Neutral < Positive)
    convert_to_ordered_int("Peer_Influence", c("Negative", "Neutral", "Positive")) %>%
    
    # Convertir Parental Education Level en valores ordenados (High School < College < Postgraduate)
    convert_to_ordered_int("Parental_Education_Level", c("High School", "College", "Postgraduate")) %>%
    
    # Convertir Distance_from_Home en valores ordenados (Near < Moderate < Far)
    convert_to_ordered_int("Distance_from_Home", c("Near", "Moderate", "Far")) %>%
    
    # Convertir a valores binarios (No = 0, Yes = 1)
    mutate(
      Extracurricular_Activities = ifelse(Extracurricular_Activities == "Yes", 1, 0),
      Internet_Access = ifelse(Internet_Access == "Yes", 1, 0),
      Learning_Disabilities = ifelse(Learning_Disabilities == "Yes", 1, 0)
    ) %>%
    
    # Aplicar One-Hot Encoding a School_Type y Gender
    mutate(
      School_Type_Private = ifelse(School_Type == "Private", 1, 0),
      School_Type_Public = ifelse(School_Type == "Public", 1, 0),
      Gender_Male = ifelse(Gender == "Male", 1, 0),
      Gender_Female = ifelse(Gender == "Female", 1, 0)
    ) %>%
    
    # Eliminar las columnas originales despu√©s de One-Hot Encoding
    select(-School_Type, -Gender)

  return(data)
}

```

```{r}
df_cleaned <- clean_and_filter_data(data)
```

```{r}
df_cleaned
```

Despu√©s de la codificaci√≥n, nuestro dataset consta de estos tipos:

```{r}
str(df_cleaned)
```

### Escalarizaci√≥n

Para que el an√°lisis sea √≥ptimo, tambi√©n es necesario escalar las variables.

-   `Sleep_Hours` toma como valor las horas de sue√±o por noche. Supondremos que el estudiante duerme esta cantidad de horas todos los d√≠as por lo que modificaremos el valor para que sean horas semanales (Multiplicamos por 7 las horas de sue√±o diarias).

-   `Tutoring_Sessions` toma como valor las sesiones de tutoria por mes. Para escalar esta variable, se tomar√° 1 sesi√≥n de tutor√≠a = 1 hora y a su vez, se pasar√° a horas semanales. Por ejemplo, si un estudiante tiene `Tutoring_Sessions` = 4 en un mes, significa que tiene 1 por semana (`Tutoring_Sessions`/ 4 semanas).

```{r}
scale_time_variables <- function(df) {
  df <- df %>%
    mutate(
      Sleep_Hours = Sleep_Hours * 7,  # Convertir de horas por noche a horas por semana
      Tutoring_Sessions = Tutoring_Sessions / 4  # Convertir sesiones a horas/semana
    )
  return(df)
}

df_cleaned <- scale_time_variables(df_cleaned)

print("Sleep_Hours:") 
summary(df_cleaned$Sleep_Hours)  # Deber√≠a estar en un rango de 0-56 horas semanales
print("Tutoring_Sessions:")
summary(df_cleaned$Tutoring_Sessions)  # Ahora representar√° horas de tutor√≠a por semana


```

Como puede observarse, para las horas de sue√±o semanales, el m√≠nimo es 28, lo cual significa que hay estudiantes que duermen 4 horas por noche (4 \* 7 = 28). La mediana es 49, lo que indica que la mayor√≠a de los estudiantes duermen aproximadamente 7 horas por noche (7 \* 7 = 49). El m√°ximo es 70, lo que implica que algunos estudiantes duermen 10 horas por noche (10 \* 7 = 70).

Por otro lado, para las horas de tutor√≠a por semana, el m√≠nimo es 0, lo cual es correcto, ya que algunos estudiantes no tienen sesiones de tutor√≠a. La mediana es 0.25, lo que significa que muchos estudiantes tienen 1 sesi√≥n por mes (1 hora / 4 = 0.25 horas/semana). El m√°ximo es 2, lo que indica que algunos estudiantes tienen 8 sesiones de tutor√≠a por mes, que equivale a 2 horas de tutor√≠a por semana.

## Visualizaciones Iniciales

## Distribuci√≥n de variables num√©ricas

```{r}
create_dist_grap <- function(df, variable, binwidth = 1, fill = "cornflowerblue") {
  if (!(variable %in% colnames(df))) {
    stop("La variable no existe en el dataframe.")
  }
  
  ggplot(df, aes_string(x = variable)) +
    geom_histogram(binwidth = binwidth, 
                   fill = fill, color = "black", bins = 20) +
    labs(title = paste(variable, "analysis"), x = variable, y = "Count") +
    theme_bw() +
    theme(plot.title = element_text(hjust = 0.5))
}

create_dist_grap(data, "Sleep_Hours")
create_dist_grap(data, "Hours_Studied")
create_dist_grap(data, "Tutoring_Sessions")
create_dist_grap(data, "Attendance", binwidth = 5)
create_dist_grap(data, "Previous_Scores")
create_dist_grap(data, "Exam_Score", fill = "orange")
```

## Distribuci√≥n de variables categ√≥ricas

```{r}
create_pie_chart <- function(df, var_name) {
  if (!(var_name %in% colnames(df))) {
    stop("La variable no existe en el dataframe.")
  }
  
  dist_var <- as.data.frame(table(df[[var_name]]))
  colnames(dist_var) <- c(var_name, "Count")
  dist_var$Percentage <- round(dist_var$Count / sum(dist_var$Count) * 100, 1)
  

  ggplot(dist_var, aes(x = "", y = Count, fill = get(var_name))) +
    geom_bar(stat = "identity", width = 1) +
    coord_polar(theta = "y") +
    geom_text(aes(label = paste0(Percentage, "%")), position = position_stack(vjust = 0.5), size = 5) +
    labs(title = paste("Distribuci√≥n de", var_name), fill=var_name) +
    theme_minimal() +
    theme(axis.text.x = element_blank(), 
          axis.ticks = element_blank(),
          panel.grid = element_blank())
}
```

```{r}
create_pie_chart(data, "Parental_Involvement")
create_pie_chart(data, "Access_to_Resources")
create_pie_chart(data, "Parental_Education_Level")
create_pie_chart(data, "Distance_from_Home")
create_pie_chart(data, "Extracurricular_Activities")
create_pie_chart(data, "School_Type")
create_pie_chart(data, "Gender")
```

## Preguntas

### ¬ø**Se pueden agrupar a los estudiantes en una clase seg√∫n sus caracter√≠sticas?**

-   **Objectivo**: Intentar asignar a los alumnos a grupos de manera que se favorezca su aprendizaje.

En primer lugar, decidimos una estrategia a adoptar para agrupar a los alumnos. Nos enfocamos en diferentes variables seg√∫n el objetivo a cumplir:

-   **Academic**: Nos interesamos en las variables que reflejan el √©xito escolar en t√©rminos acad√©micos, como la asistencia, el n√∫mero de horas de estudio o los resultados obtenidos.

-   **Support**: Aqu√≠, el enfoque est√° en las necesidades de apoyo del alumno. ¬øNecesita horas de tutor√≠a? ¬øTiene dificultades para aprender?

-   **Resource**: ¬øDispone el alumno de los recursos necesarios para favorecer su aprendizaje?

-   **Extra**: Variables relacionadas con el ocio y la vida social. ¬øTiene el alumno actividades extracurriculares? ¬øCu√°les son sus relaciones de amistad?

```{r}
academic_columns <- c("Hours_Studied", "Attendance", "Exam_Score", "Previous_Scores")
support_columns <- c("Learning_Disabilities", "Tutoring_Sessions", "Access_to_Resources")
resource_columns <- c("Family_Income", "Access_to_Resources", "Internet_Access", "Parental_Education_Level")
extra_columns <- c("Extracurricular_Activities", "Physical_Activity", "Peer_Influence")
```

```{r}
df_scaled = as_tibble(scale(df_cleaned))

data_for_cluster_academic <- select(df_scaled, all_of(academic_columns))
data_for_cluster_support <- select(df_scaled, all_of(support_columns))
data_for_cluster_resource <- select(df_scaled, all_of(resource_columns))
data_for_cluster_extra <- select(df_scaled, all_of(extra_columns))
```

Para agrupar a los alumnos seg√∫n estas categor√≠as, utilizaremos el m√©todo de **clustering K-Means**.

Primero, definimos una funci√≥n que nos permita seleccionar el mejor valor de **K**.

```{r}
compare_k <- function(df) {
  print(fviz_nbclust(df, kmeans, method = "wss") + 
    ggtitle("Elbow Method for Optimal K"))

  print(fviz_nbclust(df, kmeans, method = "silhouette") + 
    ggtitle("Silhouette Method for Optimal K"))
}
```

Luego, definimos una funci√≥n que aplique el clustering y a√±ada la variable **cluster** a nuestro conjunto de datos inicial.

```{r}
applying_kmeans <- function(data_for_clustering, k){
  set.seed(42)
  kmeans_model <- kmeans(data_for_clustering, centers = k, nstart = 25)
  df_with_cluster <- as_tibble(df_cleaned)
  df_with_cluster$Cluster <- as.factor(kmeans_model$cluster)
  return(df_with_cluster)
}
```

Finalmente, definimos una funci√≥n que nos permita **comparar los grupos formados**:\
- ¬øCu√°ntos alumnos hay en cada cluster?\
- Comparaci√≥n de las variables utilizadas en el clustering mediante **ridgeline plots**.

```{r}
print_clustering_results <- function(df_with_clusters, data_for_cluster, columns_to_focus){
  cluster_summary <- df_with_clusters %>%
    group_by(Cluster) %>%
    summarise(
      Num_Students = n()
    )
  
  print(ggplot(cluster_summary, aes(x = as.factor(Cluster), y = Num_Students, fill = as.factor(Cluster))) +
    geom_bar(stat = "identity") +
    labs(title = "Number of Students in Each Cluster", x = "Cluster", y = "Student Count") +
    theme_minimal())
  
  for (column in columns_to_focus) {
    print(ggplot(df_with_clusters, aes(x = !!sym(column), y = Cluster, fill = Cluster)) +
      geom_density_ridges() +
      labs(title = paste(column, " in Each Cluster"), x = column, y = "Cluster") +
      theme_ridges() + 
      theme(legend.position = "none"))
  }
  
  print(fviz_cluster(list(data = data_for_cluster, cluster = df_with_clusters$Cluster),
               geom = "point",
               ellipse.type = "convex",
               ggtheme = theme_minimal(),
               main = "Cluster Visualization (PCA Projection)"))
}
```

#### Academic

```{r}
compare_k(data_for_cluster_academic)
```

Analizando las gr√°ficas del m√©todo del Codo (Elbow Method) y del Coeficiente de Silhouette, llegamos a la conclusi√≥n de que el n√∫mero √≥ptimo de cl√∫steres es ùëò = 2 k=2.

Esta conclusi√≥n se fundamenta en dos aspectos clave:

**M√©todo del Codo (Elbow Method)**: En esta gr√°fica, observamos que la mayor reducci√≥n en la suma de cuadrados dentro del grupo ocurre hasta ùëò = 2 k=2, formando un punto de inflexi√≥n o "codo" en ese valor. A partir de ùëò = 2 k=2, la disminuci√≥n en la varianza interna de los cl√∫steres se vuelve menos pronunciada, lo que indica que agregar m√°s cl√∫steres no aporta una mejora significativa en la compactaci√≥n de los datos.

**Coeficiente de Silhouette (Silhouette Method)**: Este m√©todo mide la calidad de la agrupaci√≥n en funci√≥n de la cohesi√≥n interna y la separaci√≥n entre cl√∫steres. En la gr√°fica correspondiente, el valor m√°s alto del coeficiente de Silhouette se encuentra en ùëò = 2 k=2, lo que indica que, con este n√∫mero de cl√∫steres, los grupos est√°n bien diferenciados y los puntos dentro de cada cl√∫ster son m√°s homog√©neos.

Dado que ambos m√©todos coinciden en que ùëò = 2 k=2 es el valor √≥ptimo, podemos concluir que dividir los datos en dos grupos proporciona una segmentaci√≥n adecuada, asegurando un equilibrio entre la reducci√≥n de la variabilidad interna y la claridad en la separaci√≥n entre cl√∫steres.

```{r}
df_cluster_academic <- applying_kmeans(data_for_cluster_academic, 2)
```

```{r}
print_clustering_results(df_cluster_academic, data_for_cluster_academic, academic_columns)
```

El Cl√∫ster 1 est√° compuesto por estudiantes que dedican m√°s horas al estudio en comparaci√≥n con los del Cl√∫ster 2. Sin embargo, la diferencia m√°s notable entre ambos grupos radica en la asistencia a clase, ya que los alumnos del Cl√∫ster 1 muestran un nivel de asistencia significativamente mayor. Este factor parece desempe√±ar un papel clave en su rendimiento acad√©mico, ya que la combinaci√≥n de una mayor dedicaci√≥n al estudio y una participaci√≥n m√°s activa en las clases les permite obtener resultados m√°s favorables en comparaci√≥n con los estudiantes del Cl√∫ster 2.

Por otro lado, los alumnos del Cl√∫ster 2 no solo estudian menos, sino que tambi√©n presentan un porcentaje de asistencia m√°s bajo, lo que podr√≠a afectar negativamente su comprensi√≥n de los contenidos y, en consecuencia, su desempe√±o acad√©mico. Estos hallazgos sugieren que tanto el tiempo de estudio como la asistencia a clase son factores determinantes en el √©xito acad√©mico de los estudiantes.

#### Support

```{r}
compare_k(data_for_cluster_support)
```

La primera gr√°fica sigue el **m√©todo del codo**, el cual eval√∫a la suma de los cuadrados dentro de los clusters (WSS) en funci√≥n del n√∫mero de clusters. El punto √≥ptimo se encuentra donde la disminuci√≥n en WSS se vuelve menos pronunciada, formando un "codo" en la curva. En este caso, se observa un cambio notable en la pendiente alrededor de k=4 y k=8, lo que indica que estos valores podr√≠an ser opciones razonables para segmentar los datos de manera eficiente.

Por otro lado, la segunda gr√°fica utiliza el **m√©todo del Silhouette** para determinar el n√∫mero √≥ptimo de clusters. En este m√©todo, se elige el valor de k que maximiza el √≠ndice de silhouette, el cual mide qu√© tan bien separados est√°n los clusters y qu√© tan cohesivos son. En la gr√°fica, el valor m√°s alto de silhouette se alcanza en k=8, lo que sugiere que este n√∫mero de clusters permite una mejor separaci√≥n entre los grupos y minimiza la superposici√≥n entre ellos.

En conclusi√≥n, aunque el m√©todo del codo sugiere que tanto k=4 como k=8 son buenas opciones, el m√©todo del Silhouette indica que k=8 ofrece la mejor separaci√≥n entre clusters. Dado que un mayor √≠ndice de silhouette implica una mejor calidad de agrupaci√≥n, la mejor elecci√≥n en este caso es k=8, ya que maximiza la cohesi√≥n dentro de los grupos y la separaci√≥n entre ellos.

```{r}
df_cluster_support <- applying_kmeans(data_for_cluster_support, 8)
```

```{r}
print_clustering_results(df_cluster_support, data_for_cluster_support, support_columns)
```

Tras analizar las distintas gr√°ficas, se ha identificado que existen tres grupos de alumnos que presentan dificultades en el aprendizaje, los cuales se corresponden con los **cl√∫steres 1, 6 y 8**. Esta identificaci√≥n es crucial, ya que permite comprender qu√© caracter√≠sticas comparten estos grupos y qu√© factores podr√≠an estar influyendo en su rendimiento acad√©mico.

Si contrastamos esta informaci√≥n con la gr√°fica de asistencia a sesiones de tutor√≠a, observamos un patr√≥n interesante: de los tres cl√∫steres con dificultades de aprendizaje, solo el **cl√∫ster 8** muestra una participaci√≥n notable en las sesiones de tutor√≠a, mientras que los **cl√∫steres 1 y 6** apenas acumulan sesiones. Esto sugiere que, aunque la tutor√≠a puede ser una herramienta clave para mejorar el aprendizaje, no todos los alumnos con dificultades la aprovechan por igual.

Otro punto destacable es la asistencia del **cl√∫ster 7** a las tutor√≠as. A pesar de que este grupo no presenta problemas de aprendizaje, registra una frecuencia de asistencia superior a la de otros cl√∫steres. Este dato podr√≠a indicar que los alumnos de este grupo buscan reforzar sus conocimientos de manera proactiva, lo que podr√≠a influir positivamente en su rendimiento.

En cuanto al acceso a recursos, la mayor√≠a de los alumnos posee un nivel medio como m√≠nimo, lo que indica que, en general, los estudiantes cuentan con cierto grado de apoyo en t√©rminos de materiales y herramientas para el aprendizaje. No obstante, hay dos excepciones que vale la pena resaltar: el **cl√∫ster 4 y el cl√∫ster 5**.

El **cl√∫ster 4** se distingue por tener un acceso a recursos significativamente bajo. Sin embargo, esto no parece afectar su rendimiento acad√©mico, ya que los alumnos de este grupo no presentan dificultades de aprendizaje y mantienen una asistencia media a las sesiones de tutor√≠a. Este caso es meritorio, ya que sugiere que, a pesar de las limitaciones en el acceso a recursos, estos alumnos han logrado mantener un nivel de aprendizaje adecuado.

Por otro lado, el **cl√∫ster 5** presenta una situaci√≥n inversa: cuenta con un acceso a recursos considerablemente alto, lo que parece haber contribuido a que sus alumnos no experimenten dificultades en el aprendizaje. Esta observaci√≥n refuerza la idea de que disponer de recursos suficientes puede ser un factor determinante en el rendimiento acad√©mico.

En cuanto a los grupos con dificultades de aprendizaje (**cl√∫steres 1, 6 y 8**), se aprecia que, en general, poseen un acceso a recursos de nivel medio, e incluso medio-alto en el caso del cl√∫ster 1. Esto indica que la disponibilidad de recursos no es un factor limitante para estos alumnos. Sin embargo, su baja participaci√≥n en las sesiones de tutor√≠a sugiere que no est√°n tomando las medidas necesarias para abordar y superar sus dificultades de aprendizaje.

El an√°lisis de los datos sugiere que la asistencia a tutor√≠as y el acceso a recursos juegan un papel importante en el desempe√±o acad√©mico de los estudiantes, aunque no son los √∫nicos factores determinantes. Si bien el acceso a recursos puede favorecer el aprendizaje, no garantiza por s√≠ solo un buen desempe√±o, como se evidencia en el caso del **cl√∫ster 1**, que cuenta con recursos pero sigue presentando dificultades.

Asimismo, la asistencia a tutor√≠as se perfila como una herramienta clave para mejorar el rendimiento acad√©mico, pero su impacto depende del grado de participaci√≥n de los alumnos. El hecho de que el **cl√∫ster 8**, a pesar de sus dificultades, asista a tutor√≠as con mayor frecuencia podr√≠a indicar un esfuerzo por mejorar, mientras que los **cl√∫steres 1 y 6** parecen no aprovechar esta opci√≥n, lo que podr√≠a estar perpetuando sus problemas.

Finalmente, la situaci√≥n del **cl√∫ster 4** demuestra que, aunque el acceso a recursos sea bajo, un compromiso activo con el aprendizaje y una asistencia moderada a tutor√≠as pueden ser suficientes para mantener un buen rendimiento acad√©mico. En contraste, el **cl√∫ster 5** refuerza la idea de que disponer de recursos puede contribuir a evitar problemas de aprendizaje.

En conclusi√≥n, para mejorar el desempe√±o de los grupos con dificultades, ser√≠a recomendable fomentar una mayor participaci√≥n en tutor√≠as y analizar qu√© otros factores, adem√°s del acceso a recursos, podr√≠an estar influyendo en su rendimiento. Implementar estrategias de motivaci√≥n y seguimiento personalizado podr√≠a ser clave para ayudar a estos estudiantes a superar sus dificultades.

#### Resources

```{r}
compare_k(data_for_cluster_resource)
```

En la primera imagen, correspondiente al **m√©todo de Elbow**, se representa la suma de los cuadrados dentro del cluster (*Total Within Sum of Squares, WSS*) en funci√≥n del n√∫mero de clusters (*k*). Este m√©todo se basa en encontrar el punto donde la disminuci√≥n de WSS empieza a desacelerarse de manera significativa, formando una especie de ‚Äúcodo‚Äù en la gr√°fica. En este caso, observamos que la curva muestra una reducci√≥n brusca hasta aproximadamente *k = 8*, despu√©s de lo cual la disminuci√≥n de WSS se vuelve menos pronunciada. Esto sugiere que *k = 8* es un buen candidato para el n√∫mero √≥ptimo de clusters, ya que m√°s all√° de este punto la ganancia en t√©rminos de reducci√≥n de varianza dentro de los clusters es menor.

Por otro lado, en la segunda imagen se muestra el resultado del **m√©todo de Silhouette**, el cual mide la calidad de la agrupaci√≥n en funci√≥n de la cohesi√≥n interna y la separaci√≥n entre los clusters. El objetivo es encontrar el valor de *k* que maximiza el ancho promedio del coeficiente de silueta, lo que indica que los puntos est√°n bien agrupados dentro de sus respectivos clusters y bien separados de otros clusters. En esta gr√°fica, el valor m√°s alto del coeficiente de silueta se observa en *k = 2*, lo que sugiere que dos clusters proporcionan la mejor separaci√≥n seg√∫n este criterio. Sin embargo, tambi√©n se observa un valor elevado en *k = 8*, lo que indica que esta cantidad de clusters tambi√©n es una opci√≥n viable.

Dado que ambos m√©todos ofrecen sugerencias distintas, la elecci√≥n del n√∫mero √≥ptimo de clusters depende del equilibrio entre la reducci√≥n de la varianza dentro de los grupos y la cohesi√≥n de los mismos. Si se busca una segmentaci√≥n m√°s detallada y precisa de los datos, *k = 8* parece ser la mejor opci√≥n, ya que proporciona un balance entre la reducci√≥n de la suma de cuadrados dentro del cluster y una separaci√≥n aceptable seg√∫n el coeficiente de silueta. Por otro lado, si se prefiere una agrupaci√≥n m√°s general y bien diferenciada, *k = 2* podr√≠a ser una alternativa adecuada. No obstante, bas√°ndonos en ambos m√©todos y considerando un compromiso entre variabilidad y cohesi√≥n, *k = 8* se perfila como la opci√≥n m√°s recomendada.

```{r}
df_cluster_resource <- applying_kmeans(data_for_cluster_resource, 8)
```

```{r}
print_clustering_results(df_cluster_resource, data_for_cluster_resource, resource_columns)
```

El an√°lisis de la primera gr√°fica, correspondiente a los ingresos familiares, revela diversas situaciones significativas dentro de los cl√∫steres analizados. En t√©rminos generales, la mayor√≠a de los cl√∫steres presentan ingresos de nivel medio. Sin embargo, algunos grupos muestran desviaciones importantes. En particular, **los cl√∫steres 1, 3 y 6** tienden hacia ingresos medio-bajos, mientras que los **cl√∫steres 2 y 7** presentan ingresos *medio-altos*. Existen, adem√°s, dos casos extremos que resultan especialmente destacables: **el cl√∫ster 4**, que cuenta con los ingresos familiares m√°s altos, y **el cl√∫ster 5**, cuyos ingresos son los m√°s bajos dentro del conjunto de datos analizado.

Si comparamos esta informaci√≥n con la gr√°fica de acceso a recursos, se pueden extraer relaciones interesantes entre el nivel de ingresos y la disponibilidad de materiales y herramientas de apoyo educativo. Para los cl√∫steres con *ingresos medio-bajos* (**1, 3 y 6**), se observa que los **cl√∫steres 3 y 6** cuentan con un acceso a recursos dentro del rango normal, mientras que el **cl√∫ster 1** presenta un acceso a recursos *muy bajo*, lo que podr√≠a estar afectando su desempe√±o acad√©mico.

Por otro lado, los cl√∫steres con ingresos medio-altos reflejan tendencias distintas. Mientras que el **cl√∫ster 2** mantiene un acceso a recursos de nivel medio, lo cual es coherente con su nivel de ingresos, el **cl√∫ster 7** sobresale al presentar un acceso a recursos significativamente alto. Este √∫ltimo caso podr√≠a estar indicando que, adem√°s de contar con ingresos favorables, este grupo de alumnos dispone de un entorno familiar que prioriza el acceso a herramientas educativas, ya sea por inversi√≥n directa o por una mayor conciencia sobre la importancia de estos recursos en el proceso de aprendizaje.

En cuanto a los cl√∫steres m√°s extremos en t√©rminos de ingresos, tambi√©n presentan situaciones particulares en relaci√≥n con el acceso a recursos. **El cl√∫ster 4**, que cuenta con los ingresos m√°s altos, dispone de acceso a recursos en un *nivel medio-alto*, lo que podr√≠a explicarse por inversiones en educaci√≥n, ayudas gubernamentales o pol√≠ticas institucionales de apoyo. En contraste, **el cl√∫ster 5**, a pesar de ser el de menores ingresos, cuenta con acceso a recursos medio-alto, lo que resulta llamativo. Esto podr√≠a indicar la presencia de programas de asistencia, becas o estrategias familiares espec√≠ficas para garantizar el acceso a herramientas educativas a pesar de las limitaciones econ√≥micas.

Pasando al an√°lisis de la gr√°fica sobre acceso a internet, se observan discrepancias relevantes. Mientras que la mayor√≠a de los cl√∫steres tienen acceso a internet, hay tres excepciones notables: **los cl√∫steres 1, 3 y 4** no cuentan con acceso, lo que podr√≠a atribuirse a diversas razones. En algunos casos, esto podr√≠a estar vinculado a factores econ√≥micos, lo que contrastar√≠a con la situaci√≥n del **cl√∫ster 4**, cuyos ingresos son altos. Este √∫ltimo caso sugiere que la falta de acceso a internet podr√≠a deberse a razones ajenas a lo econ√≥mico, como restricciones parentales o decisiones personales dentro del hogar. En familias con hijos menores, es posible que los padres restrinjan el acceso a internet como medida de control o protecci√≥n, lo que podr√≠a estar limitando las oportunidades de aprendizaje de los estudiantes en entornos digitales.

Finalmente, la √∫ltima gr√°fica analiza el nivel educativo de los padres, y aqu√≠ se aprecia una distribuci√≥n bastante equilibrada. En general, la mayor√≠a de los grupos cuentan con padres que han alcanzado al menos el nivel de graduado de instituto, mientras que un porcentaje menor ha accedido a estudios universitarios o de postgrado. Sin embargo, hay un caso particular que sobresale: el **cl√∫ster 7**. En este grupo, los padres de los alumnos tienen un nivel educativo significativamente m√°s alto que en los dem√°s cl√∫steres, ya que, como m√≠nimo, cuentan con un t√≠tulo universitario y, en muchos casos, poseen estudios de postgrado. Esta variable podr√≠a estar incidiendo en el mayor acceso a recursos y la participaci√≥n activa en el proceso educativo de los alumnos de este cl√∫ster.

#### Social

```{r}
compare_k(data_for_cluster_extra)
```

Para determinar el n√∫mero √≥ptimo de clusters k, se han utilizado dos m√©todos: el m√©todo del codo y el m√©todo del silhouette. En el gr√°fico del m√©todo del codo, se observa que la "Suma de Cuadrados Dentro del Grupo" disminuye considerablemente hasta aproximadamente k=3 o k=4, donde la pendiente empieza a estabilizarse, indicando que agregar m√°s clusters genera una menor ganancia en la reducci√≥n de la variabilidad dentro de los grupos. Por otro lado, en el gr√°fico del m√©todo del silhouette, el valor m√°ximo de la "Anchura Promedia del Silhouette" se alcanza en k=10, aunque otros valores como k=8 y k=3 tambi√©n presentan valores relativamente altos, lo que sugiere que estos n√∫meros de clusters permiten una mejor separaci√≥n entre los grupos. Dado que el m√©todo del codo sugiere un k √≥ptimo de 3 o 4, y el m√©todo del silhouette indica que k=10 maximiza la cohesi√≥n y separaci√≥n entre los clusters, pero tambi√©n muestra un buen desempe√±o en k=3, se puede concluir que un valor razonable y equilibrado para k ser√≠a **3 o 4**, ya que logra un buen compromiso entre simplicidad del modelo y calidad de la segmentaci√≥n.

```{r}
df_cluster_extra <- applying_kmeans(data_for_cluster_extra, 3)
```

```{r}
print_clustering_results(df_cluster_extra, data_for_cluster_extra, extra_columns)
```

El an√°lisis de los gr√°ficos permite identificar diversos patrones en la relaci√≥n entre la realizaci√≥n de actividades extracurriculares, la cantidad de horas dedicadas a la actividad f√≠sica y la influencia que ejercen los compa√±eros sobre los alumnos.

El primer gr√°fico examina la participaci√≥n de los estudiantes en actividades extracurriculares, dividiendo a los alumnos en tres categor√≠as bien diferenciadas. En primer lugar, se encuentra el grupo de estudiantes que no realiza ninguna actividad extracurricular. En segundo lugar, aquellos que s√≠ participan activamente en este tipo de actividades. Finalmente, el tercer grupo est√° compuesto por alumnos que presentan una situaci√≥n mixta, es decir, donde algunos realizan actividades extracurriculares y otros no. Esta distribuci√≥n es clave para comprender c√≥mo la participaci√≥n en actividades complementarias puede influir en otros aspectos del desarrollo de los estudiantes.

Si contrastamos esta informaci√≥n con el segundo gr√°fico, que analiza la cantidad de horas dedicadas a la actividad f√≠sica, observamos que **los tres cl√∫steres** presentan un comportamiento similar. Es decir, independientemente de si los alumnos participan o no en actividades extracurriculares, la distribuci√≥n de horas dedicadas a la actividad f√≠sica sigue un patr√≥n homog√©neo. En todos los casos, se encuentran alumnos que realizan entre una y cinco horas semanales de ejercicio f√≠sico. Este hallazgo sugiere que la actividad f√≠sica no est√° necesariamente condicionada por la participaci√≥n en actividades extracurriculares, sino que puede depender de otros factores como la rutina personal, el inter√©s individual o las pol√≠ticas escolares que fomenten la pr√°ctica deportiva.

El tercer gr√°fico aporta informaci√≥n relevante sobre la influencia del compa√±erismo en la vida de los estudiantes. En este caso, se observa un resultado llamativo: tanto los alumnos que no realizan actividades extracurriculares como aquellos que s√≠ lo hacen presentan niveles de influencia social similares, caracterizados por una influencia de los compa√±eros calificada como "normal-alta". Esto indica que, independientemente de su participaci√≥n en actividades fuera del horario escolar, los estudiantes suelen verse influenciados por su grupo de pares en niveles similares.

Sin embargo, la situaci√≥n cambia cuando se analiza **el tercer grupo**, conformado por aquellos estudiantes que pertenecen a un cl√∫ster mixto, es decir, donde algunos compa√±eros participan en actividades extracurriculares y otros no. En este caso, se detecta que la influencia del compa√±erismo es nula. Este resultado sugiere que en entornos donde coexisten ambos perfiles de alumnos, la din√°mica social es distinta y el efecto del grupo no ejerce un impacto significativo en las decisiones individuales de los estudiantes.

El an√°lisis de estos datos permite extraer algunas conclusiones importantes. En primer lugar, la realizaci√≥n de actividades extracurriculares no parece tener un impacto directo en la cantidad de horas dedicadas a la actividad f√≠sica, ya que los tres grupos analizados presentan una distribuci√≥n similar en este aspecto. En segundo lugar, la influencia del compa√±erismo es notablemente alta en los estudiantes que pertenecen a grupos homog√©neos (ya sea que todos realicen o no actividades extracurriculares). Sin embargo, en los grupos mixtos, donde algunos alumnos participan y otros no, la influencia de los compa√±eros es pr√°cticamente inexistente. Esto podr√≠a indicar que la cohesi√≥n del grupo y la uniformidad en las actividades desempe√±adas juegan un papel clave en la construcci√≥n de la identidad colectiva y en la capacidad de los compa√±eros para influir en las decisiones individuales.

### ¬øCu√°ntas horas de trabajo personal necesita un estudiante para obtener una alta calificaci√≥n?

-   **Objetivo**: Determinar la cantidad √≥ptima de horas semanales de trabajo personal necesarias para que un estudiante alcance una alta calificaci√≥n.

El primer paso es definir un criterio para clasificar una calificaci√≥n como "alta". Para ello, establecemos un umbral basado en un **Notable Alto**, lo que equivale aproximadamente a una calificaci√≥n media de **8 o superior**.

A continuaci√≥n, debemos identificar a aquellos estudiantes que cumplan con dicho requisito para centrar el an√°lisis en este grupo espec√≠fico. Para ello, filtramos el conjunto de datos y seleccionamos √∫nicamente las instancias en las que la variable **Previous_Scores** sea superior a **80** (considerando que las calificaciones en el dataset est√°n expresadas en una escala de 0 a 100).

Este filtrado nos permitir√° focalizarnos en los estudiantes con alto rendimiento y analizar los factores que podr√≠an haber influido en su desempe√±o acad√©mico.

Para ello, filtramos las observaciones donde la variable `Previous_Scores` tenga un valor superior a 80.

Adem√°s, al centrarnos la variables `Previous_Scores` eliminaremos del conjunto de datos la variable `Exam_Score`.

```{r}
data_notas_altas <- df_cleaned[df_cleaned$Previous_Scores >= 80,]
data_notas_altas <- subset(data_notas_altas, select = -Exam_Score)
data_notas_altas
```

Podemos observar en el siguiente gr√°fico de tarta la distribuci√≥n de "altas calificaciones" respecto a la variable `Previous_Scores`.

```{r}
data$calificacion_categoria <- ifelse(data$Previous_Scores > 80, "Alta calificaci√≥n", "Resto de calificaciones")


categoria_counts <- as.data.frame(table(data$calificacion_categoria))
categoria_counts$percentage <- round(100 * categoria_counts$Freq / sum(categoria_counts$Freq), 1)

ggplot(categoria_counts, aes(x = "", y = Freq, fill = Var1)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar(theta = "y") +
  labs(title = "Distribuci√≥n de Calificaciones en Previous Exams", 
       x = NULL, y = NULL) +
  theme_minimal() +
  theme(axis.text = element_blank(), 
        axis.ticks = element_blank(),
        plot.title = element_text(hjust = 0.5)) +
  geom_text(aes(label = paste(percentage, "%")), position = position_stack(vjust = 0.5))

```

Para nuestro estudio debemos crear una nueva m√©trica que refleje de forma general las **horas semanales de trabajo del estudiante**. Para ello, vamos a combinar varias de las variables disponibles para obtener una estimaci√≥n m√°s completa de las horas de dedicaci√≥n del estudiante. Algunas de las variables que podr√≠an influir directamente en las horas de trabajo semanales incluyen:

-   `Hours_Studied`: El n√∫mero de horas que el estudiante estudia.
-   `Tutoring_Sessions`: El n√∫mero de sesiones de tutor√≠a.

La f√≥rmula para las horas semanales de trabajo es

\$Horas_Semanales_Work = Hours_Studied + Tutoring_Sessions \$.

Donde:

-   `Hours_Studied`: N√∫mero de horas estudiadas.

-   `Tutoring_Sessions`: N√∫mero de sesiones de tutor√≠a ( 1 hora por sesi√≥n).

```{r}
if ("Hours_Studied" %in% names(data_notas_altas) & 
    "Tutoring_Sessions" %in% names(data_notas_altas) & 
    "Physical_Activity" %in% names(data_notas_altas)){
  
  data_notas_altas$Horas_Semanales_Work <- data_notas_altas$Hours_Studied +               data_notas_altas$Tutoring_Sessions

  data_notas_altas <- data_notas_altas[, !(names(data_notas_altas) %in% c("Hours_Studied", "Tutoring_Sessions", "Physical_Activity"))]
} else {
  print("Las columnas necesarias ya han sido eliminadas.")
}
  
summary(data_notas_altas$Horas_Semanales_Work)
```

```{r}
data_numeric <- data_notas_altas[, sapply(data_notas_altas, is.numeric)]
data_scaled <- as.data.frame(scale(data_numeric))
data_notas_altas[, sapply(data_notas_altas, is.numeric)] <- data_scaled
data_notas_altas
```

Una vez identificados los estudiantes con altas calificaciones, el siguiente paso es identificar cuales son aquellos factores que influyen m√°s en las altas calificaciones del alumno. Para ello, generamos una **matriz de correlaci√≥n** junto con un **mapa de calor**, lo que nos permitir√° visualizar de manera clara c√≥mo se relacionan las variables num√©ricas dentro del conjunto de datos.

Con este an√°lisis podremos detectar si existe una asociaci√≥n significativa entre las horas de estudio personal y las calificaciones obtenidas. Adem√°s, nos permitir√° observar la influencia de otros factores, como las horas de sue√±o, la asistencia a tutor√≠as o la participaci√≥n en actividades extracurriculares, en el rendimiento acad√©mico de los estudiantes con mejores notas.

```{r}
matriz_correlacion <- cor(data_notas_altas)
matriz_melt <- melt(matriz_correlacion)

ggplot(data = matriz_melt, aes(Var1, Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(-1, 1), space = "Lab", 
                       name = "Correlaci√≥n") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
  labs(x = "Variables", y = "Variables", title = "Mapa de Calor de Correlaci√≥n")
```

El resultado de la matriz de correlaci√≥n nos arroja que no existe gran correlaci√≥n entre variables.

```{r}
model1 = lm(Horas_Semanales_Work ~ ., data = data_notas_altas)
summary(model1)
```

```{r}
data_notas_alta_simplificado <- data_notas_altas %>% dplyr::select(-School_Type_Public, -Gender_Female)
data_notas_alta_simplificado
```

```{r}
vif_values <- vif(lm(Horas_Semanales_Work ~ ., data = data_notas_alta_simplificado))
print(vif_values)
```

```{r}
indices <- sample(1:nrow(data_notas_alta_simplificado), size = 0.7 * nrow(data_notas_alta_simplificado))
train_data <- data_notas_alta_simplificado[indices, ]
test_data <- data_notas_alta_simplificado[-indices, ]
```

```{r}
library(MASS)
model_reduced <- stepAIC(lm(Horas_Semanales_Work ~ .^2, data = train_data), direction = "both")
summary(model_reduced)
```

```{r}
predicciones <- predict(model_reduced, newdata = test_data)
```

```{r}
comparacion <- data.frame(Real = test_data$Horas_Semanales_Work, Predicha = predicciones)
comparacion
```

```{r}
residuos <- comparacion$Real - comparacion$Predicha
rmse <- sqrt(mean(residuos^2))
print(paste("RMSE: ", rmse))
```
